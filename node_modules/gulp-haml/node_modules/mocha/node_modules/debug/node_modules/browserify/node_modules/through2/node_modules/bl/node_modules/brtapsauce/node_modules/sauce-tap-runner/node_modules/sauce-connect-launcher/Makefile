SHELL = /bin/bash
export PATH := ./node_modules/.bin/:${PATH}

# Shows available commands
help:
	@make -qp | grep '^[^\# \n\\.]' | grep '^[a-z]' | grep -v '=' | cut -f1 -d ":" | sort

test:
	@make setup
	@make clean
	@make lint
	@mocha --reporter spec $(MOCHAFLAGS)

# Lints the code
lint:
	@grunt jshint

all:
	@make setup
	@grunt

dev:
	@make all && \
	grunt watch

clean:
	@rm -f lib/Sauce-Connect.jar \
		lib/Sauce-Connect-latest.zip \
		lib/NOTICE.txt lib/license.html \
		lib/readyfile \
		sauce_connect.log* \
		npm-debug.log


# Creates new releases by running these steps
#
# 1. bump the version in your package.json file.
# 2. stage the package.json file's change.
# 3. commit that change with a message like "release 0.6.22".
# 4. create a new git tag for the release.
# 5. push the changes out to github.
# 6. also push the new tag out to github.
# 7. publish to npm.
release:
	@make install-grunt-release
	@make lint
	@make test
	@make clean
	@rm -f user.json
	@grunt release$(RELEASEFLAGS)

# Releases updating