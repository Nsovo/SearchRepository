PACKAGE = nodeunit
NODEJS = $(if $(shell test -f /usr/bin/nodejs && echo "true"),nodejs,node)

PREFIX ?= /usr/local
BINDIR ?= $(PREFIX)/bin
DATADIR ?= $(PREFIX)/share
MANDIR ?= $(PREFIX)/share/man
LIBDIR ?= $(PREFIX)/lib
NODEJSLIBDIR ?= $(LIBDIR)/$(NODEJS)

BUILDDIR = dist

DOCS = $(shell find doc -name '*.md' \
				|sed 's|.md|.1|g' \
				|sed 's|doc/|man1/|g' \
				)


$(shell if [ ! -d $(BUILDDIR) ]; then mkdir $(BUILDDIR); fi)

all: build doc

browser:
	# super hacky build script for browser version!
	mkdir -p $(BUILDDIR)/browser
	rm -rf $(BUILDDIR)/browser/*
	# build browser version of nodeunit.js
	cat share/license.js >> $(BUILDDIR)/browser/nodeunit.js
	echo "nodeunit = (function(){" >> $(BUILDDIR)/browser/nodeunit.js
	cat deps/json2.js >> $(BUILDDIR)/browser/nodeunit.js
	# make assert global
	echo "var assert = this.assert = {};" >> $(BUILDDIR)/browser/nodeunit.js
	echo "var types = {};" >> $(BUILDDIR)/browser/nodeunit.js
	echo "var core = {};" >> $(BUILDDIR)/browser/nodeunit.js
	echo "var nodeunit = {};" >> $(BUILDDIR)/browser/nodeunit.js
	echo "var reporter = {};" >> $(BUILDDIR)/browser/nodeunit.js
	cat deps/async.js >> $(BUILDDIR)/browser/nodeunit.js
	echo "(function(exports){" >> $(BUILDDIR)/browser/nodeunit.js
	cat lib/assert.js >> $(BUILDDIR)/browser/nodeunit.js
	echo "})(assert);" >> $(BUILDDIR)/browser/nodeunit.js
	echo "(function(exports){" >> $(BUILDDIR)/browser/nodeunit.js
	cat lib/types.js >> $(BUILDDIR)/browser/nodeunit.js
	echo "})(types);" >> $(BUILDDIR)/browser/nodeunit.js
	echo "(functio